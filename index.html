<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Nightingale Ledger: Shared Ledger System</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Fonts for the intimate, themed style -->
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    
    <style>
        /* Base Intimate Styling */
        body {
            font-family: 'Playfair Display', serif;
            background: linear-gradient(to bottom right, #0a0a0c 0%, #1a1a1d 100%); /* Deep charcoal to near black gradient */
            min-height: 100vh;
            color: #d4d4dc; /* Light grey for text */
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        h1, h2, h3 {
            font-family: 'Cinzel', serif;
            color: #b05c6c; /* Deep romantic red/plum */
        }
        .card {
            background-color: #242429; /* Darker background for main containers */
            border: 1px solid #3c3c45;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
            border-radius: 12px;
            padding: 24px;
        }
        .btn-primary {
            background-color: #b05c6c; /* Primary button color (plum) */
            color: #fff;
            padding: 10px 20px;
            transition: background-color 0.2s, transform 0.1s;
        }
        .btn-primary:hover {
            background-color: #9d4d5e;
            transform: translateY(-1px);
        }
        .btn-secondary {
            background-color: #3c3c45; /* Secondary/accent color */
            color: #d4d4dc;
            padding: 10px 20px;
            transition: background-color 0.2s, transform 0.1s;
        }
        .btn-secondary:hover {
            background-color: #4a4a55;
            transform: translateY(-1px);
        }
        /* Custom scrollbar for themed look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1a1a1d;
        }
        ::-webkit-scrollbar-thumb {
            background: #3c3c45;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #b05c6c;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="text-5xl md:text-6xl font-bold mb-2">The Nightingale Ledger</h1>
            <p class="text-lg text-gray-400 font-sans italic">A Shared Accountability System</p>
        </header>

        <!-- 
            ====================================================
            1. LEDGER SETUP SCREEN (New/Fixed)
            ==================================================== 
        -->
        <section id="ledger-setup-screen" class="card text-center max-w-lg mx-auto p-8">
            <h2 class="text-3xl font-bold mb-6">Establish the Contract</h2>

            <!-- Success/Failure Message Box -->
            <div id="setup-message-box" class="hidden p-3 mb-4 rounded-lg text-sm font-sans" role="alert"></div>

            <p class="text-lg mb-6 text-gray-400">Join an existing ledger or host a new one.</p>
            
            <div class="space-y-4">
                <input type="text" id="ledger-code-input" placeholder="Enter Ledger Code to Join" 
                       class="w-full p-3 bg-[#1a1a1d] border border-[#3c3c45] rounded-lg text-white font-sans text-center tracking-wider">
                
                <button onclick="window.joinLedger()" class="btn-primary w-full rounded-lg font-sans font-semibold">Join Existing Ledger</button>
            </div>

            <div class="my-6 flex items-center">
                <div class="flex-grow border-t border-[#3c3c45]"></div>
                <span class="flex-shrink mx-4 text-gray-500 font-sans">OR</span>
                <div class="flex-grow border-t border-[#3c3c45]"></div>
            </div>

            <p class="text-sm text-gray-500 mb-4">Host a new ledger to generate a unique code for your partner.</p>
            <button onclick="window.hostNewLedger()" class="btn-secondary w-full rounded-lg font-sans font-semibold">Host New Ledger</button>

            <div id="new-ledger-info" class="hidden mt-6 p-4 bg-[#1a1a1d] border border-[#b05c6c] rounded-lg">
                <p class="text-sm mb-2 text-[#b05c6c] font-sans">Your new Ledger Code is:</p>
                <code id="display-ledger-code" class="text-xl font-bold tracking-widest text-white block bg-black p-2 rounded-md mb-3 select-all"></code>
                <button onclick="window.copyToClipboard('display-ledger-code')" class="text-xs text-gray-400 hover:text-white transition font-sans">
                    [Click to Copy]
                </button>
            </div>
        </section>


        <!-- 
            ====================================================
            2. MAIN GAME CONTENT (Hidden until Ledger is set)
            ==================================================== 
        -->
        <div id="game-content" class="hidden">
            <!-- User Modal / Alert System -->
            <div id="modal-container" class="hidden fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center p-4" onclick="window.closeModal()">
                <div class="card max-w-md w-full" onclick="event.stopPropagation()">
                    <h3 id="modal-title" class="text-2xl font-bold mb-4 text-[#b05c6c]"></h3>
                    <p id="modal-message" class="mb-6 text-gray-300 font-sans"></p>
                    <button onclick="window.closeModal()" class="btn-primary w-full rounded-lg font-sans font-semibold">Close</button>
                </div>
            </div>

            <!-- Header and Scoreboard -->
            <div class="card mb-8">
                <h2 class="text-3xl text-center mb-6">Scoreboard</h2>
                <p class="text-center text-sm mb-4 font-sans text-gray-400">Current Ledger: <code id="current-ledger-id">Loading...</code></p>
                
                <div class="flex justify-around items-center text-center font-sans">
                    <div class="w-1/3">
                        <h3 class="text-xl font-bold text-green-400" id="keeper-name">Keeper</h3>
                        <p class="text-5xl font-bold text-green-400" id="keeper-score">0</p>
                    </div>
                    <div class="w-1/3 text-4xl font-bold text-[#b05c6c]">VS</div>
                    <div class="w-1/3">
                        <h3 class="text-xl font-bold text-blue-400" id="nightingale-name">Nightingale</h3>
                        <p class="text-5xl font-bold text-blue-400" id="nightingale-score">0</p>
                    </div>
                </div>
            </div>

            <!-- Player Assignment -->
            <section class="card mb-8">
                <h2 class="text-2xl mb-4">Player Roles</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Keeper Assignment -->
                    <div class="p-4 bg-[#1a1a1d] rounded-lg">
                        <label for="keeper-input" class="block text-green-400 font-semibold mb-2">Keeper (Disciplinarian)</label>
                        <input type="text" id="keeper-input" placeholder="Name" onchange="window.updatePlayerName('keeper', this.value)" class="w-full p-2 bg-[#0a0a0c] border border-green-700 rounded-md text-white font-sans">
                    </div>
                    <!-- Nightingale Assignment -->
                    <div class="p-4 bg-[#1a1a1d] rounded-lg">
                        <label for="nightingale-input" class="block text-blue-400 font-semibold mb-2">Nightingale (The Subject)</label>
                        <input type="text" id="nightingale-input" placeholder="Name" onchange="window.updatePlayerName('nightingale', this.value)" class="w-full p-2 bg-[#0a0a0c] border border-blue-700 rounded-md text-white font-sans">
                    </div>
                </div>
            </section>
            
            <!-- Ledger Management Sections -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Habits Section -->
                <section class="lg:col-span-2 card">
                    <h2 class="text-2xl mb-4 flex justify-between items-center">
                        Daily Habits <span id="habit-count" class="text-sm font-sans text-gray-400"> (0 Total)</span>
                    </h2>
                    
                    <!-- Habit Form -->
                    <button onclick="window.toggleHabitForm()" class="btn-secondary w-full rounded-lg font-sans font-semibold mb-4">
                        + Define New Habit
                    </button>

                    <div id="new-habit-form" class="hidden p-4 mb-6 bg-[#1a1a1d] rounded-lg border border-[#3c3c45]">
                        <input type="text" id="new-habit-desc" placeholder="Habit Description (e.g., Meditate for 15 mins)" class="w-full p-3 mb-4 bg-[#0a0a0c] border border-[#3c3c45] rounded-lg text-white font-sans">
                        <div class="flex space-x-3 mb-4 font-sans">
                            <input type="number" id="new-habit-points" placeholder="Points" value="10" min="1" class="w-1/3 p-3 bg-[#0a0a0c] border border-[#3c3c45] rounded-lg text-white">
                            <input type="number" id="new-habit-times" placeholder="Times/Day" value="1" min="1" class="w-1/3 p-3 bg-[#0a0a0c] border border-[#3c3c45] rounded-lg text-white">
                            <select id="new-habit-assignee" class="w-1/3 p-3 bg-[#0a0a0c] border border-[#3c3c45] rounded-lg text-white">
                                <option value="keeper">Keeper (Green)</option>
                                <option value="nightingale" selected>Nightingale (Blue)</option>
                            </select>
                        </div>
                        <div class="flex space-x-3">
                            <button onclick="window.generateExample('habit')" class="btn-secondary rounded-lg font-sans flex-1">Generate Example</button>
                            <button onclick="window.addHabit()" class="btn-primary rounded-lg font-sans flex-1">Define Habit</button>
                        </div>
                    </div>
                    
                    <!-- Habit List -->
                    <div id="habits-list" class="space-y-4">
                        <p class="text-center py-4 text-gray-500 italic" id="habits-loading">No habits defined yet.</p>
                    </div>
                </section>

                <!-- Rewards & Punishments Section -->
                <div class="lg:col-span-1 space-y-8">
                    
                    <!-- Rewards Section -->
                    <section class="card">
                        <h2 class="text-2xl mb-4 flex justify-between items-center">
                            Rewards <span id="reward-count" class="text-sm font-sans text-gray-400"> (0 Total)</span>
                        </h2>

                        <!-- Reward Form -->
                        <button onclick="window.toggleRewardForm()" class="btn-secondary w-full rounded-lg font-sans font-semibold mb-4">
                            + Define New Reward
                        </button>
                        
                        <div id="new-reward-form" class="hidden p-4 mb-6 bg-[#1a1a1d] rounded-lg border border-[#3c3c45]">
                            <input type="text" id="new-reward-title" placeholder="Reward Title" class="w-full p-3 mb-3 bg-[#0a0a0c] border border-[#3c3c45] rounded-lg text-white font-sans">
                            <input type="number" id="new-reward-cost" placeholder="Cost (Points)" value="50" min="1" class="w-full p-3 mb-3 bg-[#0a0a0c] border border-[#3c3c45] rounded-lg text-white font-sans">
                            <textarea id="new-reward-desc" placeholder="Detailed description of the reward..." class="w-full p-3 mb-4 bg-[#0a0a0c] border border-[#3c3c45] rounded-lg text-white h-20 font-sans"></textarea>
                            <div class="flex space-x-3">
                                <button onclick="window.generateExample('reward')" class="btn-secondary rounded-lg font-sans font-semibold flex-1">Generate Example</button>
                                <button onclick="window.addReward()" class="btn-primary rounded-lg font-sans font-semibold flex-1">Define Reward</button>
                            </div>
                        </div>

                        <!-- Reward List -->
                        <div id="rewards-list" class="space-y-3">
                            <p class="text-center py-4 text-gray-500 italic" id="rewards-loading">No rewards defined yet.</p>
                        </div>
                    </section>

                    <!-- Punishments Section -->
                    <section class="card">
                        <h2 class="text-2xl mb-4 flex justify-between items-center">
                            Punishments <span id="punishment-count" class="text-sm font-sans text-gray-400"> (0 Total)</span>
                        </h2>

                        <!-- Punishment Form -->
                        <button onclick="window.togglePunishmentForm()" class="btn-secondary w-full rounded-lg font-sans font-semibold mb-4">
                            + Define New Punishment
                        </button>

                        <div id="new-punishment-form" class="hidden p-4 mb-6 bg-[#1a1a1d] rounded-lg border border-[#3c3c45]">
                            <input type="text" id="new-punishment-title" placeholder="Punishment Title" class="w-full p-3 mb-3 bg-[#0a0a0c] border border-[#3c3c45] rounded-lg text-white font-sans">
                            <textarea id="new-punishment-desc" placeholder="Detailed description of the punishment..." class="w-full p-3 mb-4 bg-[#0a0a0c] border border-[#3c3c45] rounded-lg text-white h-20 font-sans"></textarea>
                            <div class="flex space-x-3">
                                <button onclick="window.generateExample('punishment')" class="btn-secondary rounded-lg font-sans font-semibold flex-1">Generate Example</button>
                                <button onclick="window.addPunishment()"" class="btn-primary rounded-lg font-sans font-semibold flex-1">Define Punishment</button>
                            </div>
                        </div>

                        <!-- Punishment List -->
                        <div id="punishments-list" class="space-y-3">
                            <p class="text-center py-4 text-gray-500 italic" id="punishments-loading">No punishments defined yet.</p>
                        </div>

                    </section>
                </div>
            </div>
        
            <!-- Debug/Footer Info -->
            <footer class="mt-12 pt-6 border-t border-[#3c3c45] text-center text-xs text-gray-500 font-sans">
                <p>User ID: <span id="current-user-id">...</span> | App ID: <span id="current-app-id">...</span></p>
                <p>Ledger Document Path: <code id="debug-doc-path">...</code></p>
            </footer>

        </div>

    </div>

    <!-- External JavaScript Imports -->
    <!-- 1. The data definitions must load first -->
    <script src="./examples.js"></script>
    <!-- 2. The main logic -->
    <script type="module" src="./script.js"></script>
</body>
</html>