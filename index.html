<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>The Nightingale Ledger</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Cormorant+Garamond:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    :root{
      --bg-start:#000000; --bg-end:#111114;
      --card-bg:#141416; --muted:#9ca3af; --accent:#b05c6c;
    }
    html,body{height:100%}
    body{
      font-family: 'Cormorant Garamond', serif;
      margin:0; min-height:100vh;
      background:linear-gradient(180deg,var(--bg-start),var(--bg-end));
      color:#e6e6e6; -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      padding:1rem;
    }

    .app-header{display:flex;align-items:center;justify-content:space-between;gap:1rem;max-width:1100px;margin:0 auto 1.25rem}
    .brand{font-family:'Cinzel',serif;color:var(--accent);font-size:1.6rem}
    .sub{color:var(--muted);font-size:0.95rem}

    .profile-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;max-width:1100px;margin:0 auto}
    @media (max-width:720px){ .profile-grid{grid-template-columns:1fr} }

    .profile-card{
      --accent: #7f00ff;
      --status-color: #2ecc71;
      --avatar-bg: #444;
      background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
      border:1px solid rgba(255,255,255,0.04);
      border-radius:12px;padding:12px;display:flex;gap:12px;align-items:center;
      box-shadow: 0 8px 24px rgba(0,0,0,0.6);
      transition: transform .18s ease, box-shadow .18s ease;
      touch-action: manipulation;
    }
    .profile-card:active{ transform: translateY(1px) scale(.998) }
    .avatar{
      width:72px;height:72px;border-radius:50%;flex:0 0 72px;display:flex;align-items:center;justify-content:center;
      color:white;font-weight:700;font-size:1.25rem;border:3px solid rgba(255,255,255,0.06);
    }
    .profile-main{flex:1;min-width:0}
    .profile-top{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .profile-name{font-weight:700;color:var(--accent);font-size:1.05rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .profile-title{font-size:0.85rem;color:var(--muted)}
    .status-row{display:flex;align-items:center;gap:8px;margin-top:8px}
    .status-dot{width:12px;height:12px;border-radius:50%;background:var(--status-color);box-shadow:0 0 8px var(--status-color)}
    .status-text{font-size:0.9rem;color:#d6d6d6;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

    .card-actions{display:flex;gap:8px;align-items:center}
    .small-btn{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:.45rem .6rem;border-radius:8px;color:inherit;font-size:.9rem}
    .small-btn:active{transform:scale(.99)}

    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:60;padding:1rem}
    .modal{width:100%;max-width:720px;background:var(--card-bg);border-radius:10px;padding:1rem;border:1px solid rgba(255,255,255,0.04);box-shadow:0 12px 40px rgba(0,0,0,0.7)}
    .form-row{display:flex;gap:0.75rem;align-items:center}
    .form-col{flex:1;min-width:0}
    .color-preview{width:36px;height:36px;border-radius:8px;border:1px solid rgba(255,255,255,0.06)}
    .presence-select{padding:.5rem;border-radius:8px;background:var(--bg-end);border:1px solid rgba(255,255,255,0.04);color:inherit}

    .muted{color:var(--muted);font-size:.85rem}
    .hidden{display:none}
    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    footer{max-width:1100px;margin:1.5rem auto 0;color:var(--muted);font-size:.85rem;text-align:center}
  </style>
</head>
<body>

  <header class="app-header" role="banner" aria-label="App header">
    <div>
      <div class="brand">The Nightingale Ledger</div>
      <div class="sub">Shared habits, points, and gentle accountability</div>
    </div>
    <div class="card-actions">
      <button id="open-settings" class="small-btn" aria-label="Open settings"><i class="fas fa-cog" aria-hidden="true"></i></button>
    </div>
  </header>

  <main id="main-content" tabindex="-1">
    <section class="profile-grid" id="profiles" aria-label="Profiles">
      <article id="profile-keeper" class="profile-card" data-role="keeper" style="--accent:#b05c6c;--status-color:#2ecc71;--avatar-bg:#b05c6c" role="region" aria-labelledby="keeper-name">
        <div class="avatar" id="avatar-keeper" role="img" aria-label="Keeper avatar">A</div>
        <div class="profile-main">
          <div class="profile-top">
            <div>
              <div id="keeper-name" class="profile-name">Alex</div>
              <div id="keeper-title" class="profile-title">The Keeper</div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
              <div style="display:flex;gap:6px">
                <button class="small-btn" onclick="openProfileEditor('keeper')" aria-label="Edit keeper profile"><i class="fas fa-edit" aria-hidden="true"></i></button>
                <button class="small-btn" onclick="randomizeProfile('keeper')" aria-label="Randomize keeper profile"><i class="fas fa-random" aria-hidden="true"></i></button>
              </div>
              <div class="muted" id="keeper-score">0 pts</div>
            </div>
          </div>
          <div class="status-row">
            <div class="status-dot" id="status-dot-keeper" aria-hidden="true"></div>
            <div id="status-keeper" class="status-text">Feeling focused</div>
          </div>
        </div>
      </article>

      <article id="profile-nightingale" class="profile-card" data-role="nightingale" style="--accent:#7f00ff;--status-color:#f1c40f;--avatar-bg:#7f00ff" role="region" aria-labelledby="nightingale-name">
        <div class="avatar" id="avatar-nightingale" role="img" aria-label="Nightingale avatar">N</div>
        <div class="profile-main">
          <div class="profile-top">
            <div>
              <div id="nightingale-name" class="profile-name">Riley</div>
              <div id="nightingale-title" class="profile-title">The Nightingale</div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
              <div style="display:flex;gap:6px">
                <button class="small-btn" onclick="openProfileEditor('nightingale')" aria-label="Edit nightingale profile"><i class="fas fa-edit" aria-hidden="true"></i></button>
                <button class="small-btn" onclick="randomizeProfile('nightingale')" aria-label="Randomize nightingale profile"><i class="fas fa-random" aria-hidden="true"></i></button>
              </div>
              <div class="muted" id="nightingale-score">0 pts</div>
            </div>
          </div>
          <div class="status-row">
            <div class="status-dot" id="status-dot-nightingale" aria-hidden="true"></div>
            <div id="status-nightingale" class="status-text">Ready to sing</div>
          </div>
        </div>
      </article>
    </section>
  </main>

  <footer role="contentinfo">Profiles are editable. Changes persist locally and can be synced to Firebase if configured.</footer>

  <div id="profile-editor-modal" class="modal-backdrop hidden" role="dialog" aria-modal="true" aria-labelledby="profile-editor-title" aria-hidden="true">
    <div class="modal" role="document">
      <h3 id="profile-editor-title" style="font-family:'Cinzel',serif;margin:0 0 .5rem 0">Edit Profile</h3>
      <form id="profile-editor-form" onsubmit="event.preventDefault(); saveProfileEditor();" aria-describedby="profile-editor-desc">
        <p id="profile-editor-desc" class="muted">Customize name, title, accent color, avatar color, and status. Changes save locally.</p>

        <div style="display:flex;gap:1rem;margin-top:.75rem;align-items:center">
          <div style="flex:0 0 84px">
            <div id="editor-avatar-preview" class="avatar" style="width:84px;height:84px;border-radius:12px">A</div>
          </div>
          <div style="flex:1;min-width:0">
            <label class="sr-only" for="editor-name">Name</label>
            <input id="editor-name" class="form-col" type="text" placeholder="Name" required style="width:100%;padding:.6rem;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit">
            <div style="height:.5rem"></div>
            <label class="sr-only" for="editor-title">Title</label>
            <input id="editor-title" class="form-col" type="text" placeholder="Title (e.g., Keeper)" style="width:100%;padding:.5rem;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit">
          </div>
        </div>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:.75rem;margin-top:.75rem">
          <div>
            <label class="sr-only" for="editor-accent">Accent color</label>
            <div style="display:flex;gap:.5rem;align-items:center">
              <input id="editor-accent" type="color" value="#7f00ff" aria-label="Accent color" style="width:100%;height:44px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent">
              <div id="editor-accent-preview" class="color-preview" aria-hidden="true"></div>
            </div>
            <div class="muted" style="margin-top:.35rem">Accent color (name & accents)</div>
          </div>

          <div>
            <label class="sr-only" for="editor-avatar-color">Avatar color</label>
            <div style="display:flex;gap:.5rem;align-items:center">
              <input id="editor-avatar-color" type="color" value="#444444" aria-label="Avatar background color" style="width:100%;height:44px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent">
              <div id="editor-avatar-preview-color" class="color-preview" aria-hidden="true"></div>
            </div>
            <div class="muted" style="margin-top:.35rem">Avatar background</div>
          </div>
        </div>

        <div style="display:flex;gap:.75rem;margin-top:.75rem;align-items:center">
          <select id="editor-presence" class="presence-select" aria-label="Presence status">
            <option value="online">Online</option>
            <option value="idle">Idle</option>
            <option value="dnd">Do not disturb</option>
            <option value="offline">Offline</option>
          </select>
          <input id="editor-status" type="text" placeholder="Custom status (e.g., 'Working on a habit')" style="flex:1;padding:.5rem;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" aria-label="Custom status">
        </div>

        <div style="display:flex;justify-content:flex-end;gap:.5rem;margin-top:1rem">
          <button type="button" class="small-btn" onclick="closeProfileEditor()" aria-label="Cancel edit">Cancel</button>
          <button type="submit" class="small-btn" style="background:var(--accent);border-color:transparent;color:white" aria-label="Save profile">Save</button>
        </div>
      </form>
    </div>
  </div>

  <script src="./examples.js" defer></script>
  <script src="./firebase_config.js" defer></script>
  <script src="./script.js" defer></script>
</body>
</html>
